<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="navbar">
        <div class="logo">
          <a href="index.html"
            ><img
              src="https://i.postimg.cc/bvDfNTP1/Lil-Media-removebg-preview.png"
              width="125px"
          /></a>
        </div>
        <nav>
          <ul id="MenuItems">
            <li><a href="index.html">Home</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="">About</a></li>
            <li><a href="">Contact</a></li>
            <li><a href="account.html">Admin</a></li>
          </ul>
        </nav>
        <a href="cart.html"
          ><img src="images/cart.png" width="30px" height="30px"
        /></a>
        <img src="images/menu.png" class="menu-icon" onClick="menutoggle()" />
      </div>
    </div>
    <div class="small-container cart-page">
      <table>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
        <tbody id="cartItems"></tbody>
      </table>

      <div class="total-price">
        <table>
          <tr>
            <td>Total</td>
            <td id="total"></td>
          </tr>
        </table>
        <div class="checkout-button">
          <button class="btn btn-primary">Checkout</button>
        </div>
      </div>
    </div>

    <script>
      // Function to remove a product from the cart
      function removeFromCart(index) {
        var cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        displayCartItems();
      }

      // Function to calculate the total price of items in the cart
      function calculateTotalPrice() {
        var cart = JSON.parse(localStorage.getItem("cart")) || [];
        var totalPrice = cart.reduce(function (total, product) {
          var price = parseFloat(product.price.replace("R", ""));
          return total + price * (product.quantity || 1);
        }, 0);
        return totalPrice.toFixed(2);
      }

      function displayCartItems() {
        var cartItemsTable = document.getElementById("cartItems");
        var totalElement = document.getElementById("total");

        var cart = JSON.parse(localStorage.getItem("cart")) || [];
        var totalPrice = calculateTotalPrice();

        cartItemsTable.innerHTML = "";
        totalElement.textContent = "R" + totalPrice;

        cart.forEach(function (product, index) {
          var row = document.createElement("tr");

          var productColumn = document.createElement("td");
          productColumn.classList.add("cart-item");

          var productImage = document.createElement("div");
          productImage.classList.add("cart-item-image");
          var image = document.createElement("img");
          image.src = product.image;
          productImage.appendChild(image);

          var productDetails = document.createElement("div");
          productDetails.classList.add("cart-item-details");

          var productName = document.createElement("div");
          productName.classList.add("cart-item-name");
          productName.textContent = product.name;

          var productPrice = document.createElement("div");
          productPrice.classList.add("cart-item-price");
          productPrice.textContent = product.price;

          var quantityColumn = document.createElement("td");
          var quantityInput = document.createElement("input");
          quantityInput.type = "number";
          quantityInput.min = 1;
          quantityInput.value = product.quantity || 1;
          quantityInput.addEventListener("input", function () {
            updateQuantity(index, parseInt(quantityInput.value));
            displayCartItems();
          });
          quantityColumn.appendChild(quantityInput);

          var subtotalColumn = document.createElement("td");
          var subtotal =
            parseFloat(product.price.replace("R", "")) *
            (product.quantity || 1);
          subtotalColumn.textContent = "R" + subtotal.toFixed(2);

          var removeColumn = document.createElement("td");
          removeColumn.classList.add("cart-item-remove");
          var removeButton = document.createElement("button");
          removeButton.textContent = "Remove";
          removeButton.addEventListener("click", function () {
            removeFromCart(index);
            displayCartItems();
          });

          removeColumn.appendChild(removeButton);
          productDetails.appendChild(productName);
          productDetails.appendChild(productPrice);

          productColumn.appendChild(productImage);
          productColumn.appendChild(productDetails);

          row.appendChild(productColumn);
          row.appendChild(subtotalColumn);
          row.appendChild(quantityColumn);
          row.appendChild(subtotalColumn);
          row.appendChild(removeColumn);

          cartItemsTable.appendChild(row);
        });
      }

      // Call the function to display cart items
      displayCartItems();
    </script>
  </body>
</html>
